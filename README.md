# General Bots Workspace

**Version:** 6.2.0
**Type:** Rust Workspace (Monorepo with Independent Subproject Repos)

---

## ‚ö†Ô∏è CRITICAL: Environment Configuration

### `.env` File - VAULT CONFIGURATION ONLY

The `.env` file is **automatically generated by Vault during bootstrap** and should **ONLY** contain Vault-related variables:

```bash
# Vault Configuration - THESE ARE THE ONLY ALLOWED ENV VARS
VAULT_ADDR=https://localhost:8200
VAULT_TOKEN=<token-generated-by-vault>
VAULT_CACERT=./botserver-stack/conf/system/certificates/ca/ca.crt
VAULT_CACHE_TTL=300

# Optional: Override default server port (default: 8088)
BOTSERVER_PORT=8088
```

### ‚õî **NEVER** manually edit `.env` to add:

- ‚ùå Secrets (API keys, passwords, etc.)
- ‚ùå Database credentials
- ‚ùå AWS/S3 credentials
- ‚ùå Email/SMTP settings
- ‚ùå JWT_SECRET (automatically generated and stored in Vault)
- ‚ùå Any other configuration values

### ‚úÖ Where to Store Configuration

All secrets are automatically generated and stored in **Vault** during bootstrap:

- `gbo/tables` - PostgreSQL credentials
- `gbo/drive` - MinIO/S3 credentials
- `gbo/cache` - Redis credentials
- `gbo/directory` - Zitadel (authentication) credentials
- `gbo/email` - Email/SMTP settings
- `gbo/llm` - LLM API keys
- `gbo/encryption` - Encryption keys
- `gbo/jwt` - JWT secret (auto-generated 48-character secure key)

### üîê Additional Environment Variables

Only these variables are allowed outside of Vault:

```bash
# Override default server port (default: 8088)
BOTSERVER_PORT=9000 ./target/debug/botserver
```

---

## Structure

This workspace contains multiple General Bots projects:

```
gb/
‚îú‚îÄ‚îÄ PROMPT.md          ‚Üê Workspace-level development guide (READ THIS FIRST)
‚îú‚îÄ‚îÄ Cargo.toml         ‚Üê Workspace configuration
‚îú‚îÄ‚îÄ README.md          ‚Üê This file
‚îÇ
‚îú‚îÄ‚îÄ botapp/            ‚Üê Desktop application (Tauri)
‚îú‚îÄ‚îÄ botserver/         ‚Üê Main server (API + business logic)
‚îú‚îÄ‚îÄ botlib/            ‚Üê Shared library (types, utilities)
‚îú‚îÄ‚îÄ botui/             ‚Üê Web UI (HTML/CSS/JS)
‚îú‚îÄ‚îÄ botbook/           ‚Üê Documentation
‚îú‚îÄ‚îÄ bottest/           ‚Üê Integration tests
‚îú‚îÄ‚îÄ botdevice/         ‚Üê Device integration
‚îú‚îÄ‚îÄ botmodels/         ‚Üê AI models
‚îú‚îÄ‚îÄ botplugin/         ‚Üê Plugin system
‚îú‚îÄ‚îÄ bottemplates/      ‚Üê Templates
‚îî‚îÄ‚îÄ target/            ‚Üê Build artifacts
```

---

## CRITICAL: PROMPT.md Files

**Each project has a PROMPT.md that defines its development rules.**

The diagnostics tool reads and respects these PROMPT.md files.

### Hierarchy

1. **`PROMPT.md`** (this directory) - Workspace-wide rules
2. **`botapp/PROMPT.md`** - Desktop app specifics
3. **`botserver/PROMPT.md`** - Server specifics
4. **`botlib/PROMPT.md`** - Library specifics
5. **`botui/PROMPT.md`** - UI specifics
6. **`botbook/PROMPT.md`** - Documentation specifics
7. **`bottest/PROMPT.md`** - Test specifics

**ALWAYS read the relevant PROMPT.md before working on a project.**

---

## Main Directive

**LOOP AND COMPACT UNTIL 0 WARNINGS - MAXIMUM YOLO**

- 0 warnings
- 0 errors
- Trust project diagnostics
- Respect all rules
- No `#[allow()]` in source code
- Real code fixes only

---

## Quick Start

### First Time Setup

```bash
# 1. Build the project
cargo build -p botserver

# 2. Start botserver (first run will bootstrap automatically)
./target/debug/botserver

# BotServer will:
#   - Create botserver-stack/ directory
#   - Download and install PostgreSQL, Vault, Redis, MinIO
#   - Initialize Vault with secure secrets
#   - Generate .env file with Vault configuration
#   - Auto-install pdftotext for PDF processing (no root required)
#   - Start all services
```

### Subsequent Runs

```bash
# Start botserver (JWT_SECRET is automatically loaded from Vault)
./target/debug/botserver

# Or with custom port
BOTSERVER_PORT=9000 ./target/debug/botserver
```

### Access Points

- **API Server**: http://localhost:8088 (or custom BOTSERVER_PORT)
- **BotUI**: http://localhost:3000
- **Vault UI**: https://localhost:8200/ui (requires init.json token)

---

## Auto-Installed During Bootstrap

BotServer automatically generates and stores all required secrets in Vault during bootstrap:

- **JWT secret** - 48-character secure key for authentication (stored at `gbo/jwt`)
- **pdftotext** - PDF text extraction utility
  - Downloaded from `poppler-utils` package
  - Installed to `botserver-stack/bin/shared/pdftotext`
  - No root/sudo required

---

## Development Workflow

1. Read `PROMPT.md` (workspace-level rules)
2. Read `<project>/PROMPT.md` (project-specific rules)
3. Use diagnostics tool to check warnings
4. Fix all warnings with full file rewrites
5. Verify with diagnostics after each file
6. Never suppress warnings with `#[allow()]`

---

## E2E Tests (YOLO Mode)

**IMPORTANT: E2E tests require running services and follow YOLO mode principles:**

### Setup
- **BotUI must be running** on `http://localhost:3000` (frontend client)
- **BotServer API** on `https://localhost:8088` (backend)
- Tests use the **existing BotUI** for UI interaction
- API calls go to the **BotServer**
- Client-side JS errors are **infrastructure-defined** (not test failures)

### Running E2E Tests
```bash
# Build botserver first
cargo build -p botserver

# Run e2e tests (one at a time for visibility)
BOTSERVER_BIN=./target/debug/botserver cargo test -p bottest --test e2e -- --nocapture --test-threads=1

# Run specific chat test
BOTSERVER_BIN=./target/debug/botserver cargo test -p bottest --test e2e test_chat_hi -- --nocapture --test-threads=1
```

### Browser Visibility
- Tests run **non-headless by default** (visible browser)
- Set `HEADLESS=1` env var for headless mode
- Set `CI=1` for CI environments (auto headless)

### YOLO Mode Principles
- Tests are **infrastructure-aware** - they detect existing services
- Client JS errors don't fail tests unless explicitly tested
- Login/auth tests may skip if infrastructure not ready
- **Maximum YOLO** - tests adapt to environment, not vice versa

---

## Git Structure

**Note:** Each subproject has its own git repository. This root repository only tracks workspace-level files:

- `PROMPT.md` - Development guide
- `Cargo.toml` - Workspace configuration
- `README.md` - This file
- `.gitignore` - Ignore patterns

Subprojects (botapp, botserver, etc.) are **not** git submodules - they are independent repositories.

---

## Rules Summary

```
‚úÖ FULL FILE REWRITES ONLY
‚úÖ BATCH ALL FIXES BEFORE WRITING
‚úÖ VERIFY WITH DIAGNOSTICS AFTER EACH FILE
‚úÖ TRUST PROJECT DIAGNOSTICS
‚úÖ RESPECT ALL RULES

‚ùå NEVER use #[allow()] in source code
‚ùå NEVER use partial edits
‚ùå NEVER run cargo check/clippy manually
‚ùå NEVER leave unused code
‚ùå NEVER use .unwrap()/.expect()
‚ùå NEVER use panic!/todo!/unimplemented!()
‚ùå NEVER add comments
‚ùå NEVER manually edit .env except for BOTSERVER_PORT
```

---

## Links

- Main Server: http://localhost:8081 (or custom BOTSERVER_PORT)
- Desktop App: Uses Tauri to wrap botui
- Documentation: See botbook/

---

## License

See individual project repositories for license information.
